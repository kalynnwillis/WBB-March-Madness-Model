---
title: "Women's Basketball March Madness: Bradley-Terry Model Analysis"
subtitle: "Analyzing 8-12 Seed Advancement Probabilities"
author: "Your Names Here"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 3
    theme: flatly
    code_folding: hide
    fig_width: 10
    fig_height: 6
  pdf_document:
    toc: true
    toc_depth: 3
    fig_width: 10
    fig_height: 6
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
    echo = TRUE,
    message = FALSE,
    warning = FALSE,
    fig.align = "center"
)

library(tidyverse)
library(here)
library(knitr)
library(kableExtra)
```

# Executive Summary

This report presents a comprehensive analysis of Women's NCAA Basketball March Madness tournament outcomes using Bradley-Terry models. We focus specifically on mid-tier seeds (8-12) to answer two key questions:

1. **How many 8-12 seeds should we expect to advance past the second round?**
2. **Given that an 8-12 seed advances past the second round, what is the probability they reach the finals or win the championship?**

## Key Findings

```{r load-results, echo=FALSE}
# Load key results
key_results <- readRDS(here("results", "tables", "key_results.rds"))
```

- **Expected 8-12 seeds in Sweet 16:** `r sprintf("%.2f", key_results$expected_in_sweet16)` teams
- **Conditional probability of reaching Finals (given Sweet 16):** `r sprintf("%.1f%%", key_results$overall_conditional$prob_finals_given_s16 * 100)`
- **Conditional probability of winning championship (given Sweet 16):** `r sprintf("%.1f%%", key_results$overall_conditional$prob_champion_given_s16 * 100)`

---

# 1. Introduction

## 1.1 Background

The NCAA Women's Basketball Tournament, commonly known as March Madness, is a single-elimination tournament featuring 64 teams seeded 1-16 across four regions. Understanding the probability of upsets and the advancement potential of mid-tier seeds is valuable for:

- Bracket predictions
- Understanding competitive balance
- Identifying over/under-seeded teams

## 1.2 Research Questions

**Research Question 1:** How many of the 8-12 seeds should we expect to advance past the second round (to the Sweet 16)?

**Research Question 2:** Given that a team ranked 8-12 advanced past the second round, what is the chance they make it all the way to the finals or win the championship?

## 1.3 Why Focus on 8-12 Seeds?

We focus on 8-12 seeds because they represent an interesting competitive sweet spot:

- **Not automatic first-round exits** (unlike 13-16 seeds)
- **Not overwhelming favorites** (unlike 1-4 seeds)
- **Competitive upset potential** - capable of deep runs but face significant challenges
- **Strategic interest** - key for bracket predictions

---

# 2. Methodology

## 2.1 Bradley-Terry Model

The Bradley-Terry model estimates latent team strengths from pairwise comparisons (game results). For each team $i$, the model assigns a strength parameter $\lambda_i$ such that:

$$P(\text{team } i \text{ beats team } j) = \frac{1}{1 + e^{-(\lambda_i - \lambda_j)}}$$

### Key Properties:

- Higher $\lambda$ indicates stronger team
- Log-odds of winning = difference in strengths
- Identifiable only up to additive constant (we fix one team's $\lambda = 0$)

## 2.2 Data

```{r data-summary, echo=FALSE}
# Load data info
team_abilities <- readRDS(here("data", "processed", "team_abilities_with_seeds.rds"))
games_cleaned <- readRDS(here("data", "processed", "games_cleaned.rds"))

n_teams <- nrow(team_abilities)
n_games <- nrow(games_cleaned)
n_tournament_teams <- sum(!is.na(team_abilities$seed))
n_mid_tier <- sum(team_abilities$seed >= 8 & team_abilities$seed <= 12, na.rm = TRUE)
```

**Data Source:** Women's NCAA Basketball data via `wncaahoopR` package

**Dataset Statistics:**

- Total teams analyzed: `r n_teams`
- Total games: `r n_games`
- Tournament teams: `r n_tournament_teams`
- Teams with 8-12 seeds: `r n_mid_tier`

## 2.3 Analysis Approach

Our analysis consists of three components:

1. **Bradley-Terry Model Fitting** - Estimate team strengths from regular season games
2. **Analytical Probability Calculations** - Calculate exact probabilities for specific matchups
3. **Monte Carlo Simulation** - Simulate 5,000 complete tournaments to estimate complex probabilities

---

# 3. Results

## 3.1 Team Strength Estimates

```{r team-strength-plot, echo=FALSE, fig.cap="Team strength distribution by seed category"}
knitr::include_graphics(here("results", "figures", "01_team_strength_by_seed.png"))
```

The Bradley-Terry model successfully distinguishes between seed categories, with higher seeds showing systematically higher estimated strengths.

### Top 10 Strongest Teams

```{r top-teams, echo=FALSE}
top_teams <- team_abilities %>%
    filter(!is.na(seed)) %>%
    arrange(desc(lambda)) %>%
    head(10) %>%
    select(
        Team = team, Seed = seed, Region = region,
        Lambda = lambda, `Std. Error` = se
    ) %>%
    mutate(
        Lambda = sprintf("%.3f", Lambda),
        `Std. Error` = sprintf("%.3f", `Std. Error`)
    )

kable(top_teams, caption = "Top 10 Strongest Teams by Bradley-Terry Model") %>%
    kable_styling(bootstrap_options = c("striped", "hover"))
```

## 3.2 First Round Performance (8-12 Seeds)

```{r first-round-plot, echo=FALSE, fig.cap="First round win probabilities for 8-12 seeds"}
knitr::include_graphics(here("results", "figures", "03_first_round_probabilities.png"))
```

```{r first-round-table, echo=FALSE}
first_round_summary <- key_results$first_round_summary %>%
    select(
        Seed = seed, `N Teams` = n_teams,
        `Avg Win Prob` = avg_prob_win, `Expected Wins` = expected_wins
    ) %>%
    mutate(
        `Avg Win Prob` = sprintf("%.1f%%", `Avg Win Prob` * 100),
        `Expected Wins` = sprintf("%.2f", `Expected Wins`)
    )

kable(first_round_summary,
    caption = "First Round Win Probabilities by Seed"
) %>%
    kable_styling(bootstrap_options = c("striped", "hover"))
```

## 3.3 Research Question 1: Expected Advancement

```{r advancement-plot, echo=FALSE, fig.cap="Expected number of 8-12 seeds advancing by round"}
knitr::include_graphics(here("results", "figures", "06_analytical_vs_simulation.png"))
```

### Answer to Research Question 1

**We expect approximately `r sprintf("%.1f", key_results$expected_in_sweet16)` of the 8-12 seeds to advance past the second round (to the Sweet 16).**

```{r advancement-table, echo=FALSE}
advancement <- key_results$second_round_summary %>%
    select(
        Seed = seed, `N Teams` = n_teams,
        `P(Round 2 Win | Round 1 Win)` = avg_prob_win_r2_conditional,
        `P(Sweet 16)` = avg_prob_reach_sweet16,
        `Expected in Sweet 16` = expected_in_sweet16
    ) %>%
    mutate(
        `P(Round 2 Win | Round 1 Win)` = sprintf(
            "%.1f%%",
            `P(Round 2 Win | Round 1 Win)` * 100
        ),
        `P(Sweet 16)` = sprintf("%.1f%%", `P(Sweet 16)` * 100),
        `Expected in Sweet 16` = sprintf("%.2f", `Expected in Sweet 16`)
    )

kable(advancement,
    caption = "Second Round Performance and Sweet 16 Expectations"
) %>%
    kable_styling(bootstrap_options = c("striped", "hover"))
```

### Breakdown by Seed

- **8 seeds:** Most likely to advance (face 9 seeds in Round 1, 1 seeds in Round 2)
- **9 seeds:** Similar probability to 8 seeds
- **10-12 seeds:** Lower but non-negligible probability of Sweet 16

## 3.4 Research Question 2: Conditional Probabilities

```{r conditional-plot, echo=FALSE, fig.cap="Conditional probabilities given Sweet 16 appearance"}
knitr::include_graphics(here("results", "figures", "07_conditional_probabilities.png"))
```

### Answer to Research Question 2

**Given that an 8-12 seed reaches the Sweet 16:**

- Probability of reaching **Elite 8**: `r sprintf("%.1f%%", key_results$overall_conditional$prob_elite8_given_s16 * 100)`
- Probability of reaching **Final Four**: `r sprintf("%.1f%%", key_results$overall_conditional$prob_final4_given_s16 * 100)`
- Probability of reaching **Finals**: `r sprintf("%.1f%%", key_results$overall_conditional$prob_finals_given_s16 * 100)`
- Probability of **winning championship**: `r sprintf("%.1f%%", key_results$overall_conditional$prob_champion_given_s16 * 100)`

```{r conditional-table, echo=FALSE}
conditional <- key_results$conditional_summary %>%
    select(
        Seed = seed,
        `P(Elite 8 | Sweet 16)` = avg_prob_elite8_given_s16,
        `P(Final Four | Sweet 16)` = avg_prob_final4_given_s16,
        `P(Finals | Sweet 16)` = avg_prob_finals_given_s16,
        `P(Champion | Sweet 16)` = avg_prob_champion_given_s16
    ) %>%
    mutate(across(where(is.numeric), ~ sprintf("%.1f%%", . * 100)))

kable(conditional,
    caption = "Conditional Advancement Probabilities by Seed"
) %>%
    kable_styling(bootstrap_options = c("striped", "hover"))
```

## 3.5 Monte Carlo Simulation Results

```{r simulation-plot, echo=FALSE, fig.cap="Distribution of 8-12 seeds by round (5000 simulations)"}
knitr::include_graphics(here("results", "figures", "05_simulation_distributions.png"))
```

### Simulation Validation

The Monte Carlo simulations (5,000 tournament replications) closely match our analytical predictions, providing confidence in our results.

```{r heatmap, echo=FALSE, fig.cap="Seed performance heatmap from simulations"}
knitr::include_graphics(here("results", "figures", "08_seed_performance_heatmap.png"))
```

---

# 4. Discussion

## 4.1 Key Insights

1. **Mid-tier seeds have realistic but challenging paths:** While 8-12 seeds can make deep runs, the probabilities decrease rapidly after the Sweet 16.

2. **Seed matters even within 8-12 range:** 8 and 9 seeds have noticeably better chances than 11 and 12 seeds.

3. **Model validation:** Strong agreement between analytical predictions and Monte Carlo simulations suggests robust model estimates.

## 4.2 Limitations

- **Constant team strength assumption:** Model doesn't account for injuries, momentum, or hot/cold streaks
- **No home court advantage:** Tournament games at neutral sites, but some teams may have geographic advantages
- **Historical data:** Team compositions change year to year
- **Simplified bracket structure:** Actual tournament has specific regional placements

## 4.3 Practical Applications

- **Bracket Strategy:** Understanding base rates helps avoid over/under-predicting upsets
- **Team Evaluation:** Teams significantly outperforming their seed expectations may be under-seeded
- **Tournament Format Analysis:** Quantifies competitive balance in the tournament structure

---

# 5. Conclusion

Using Bradley-Terry models combined with Monte Carlo simulation, we provide rigorous answers to our research questions:

1. **Approximately 2-3 of the 8-12 seeds should advance to the Sweet 16** in a typical tournament
2. **An 8-12 seed that reaches the Sweet 16 has roughly a 10-20% chance of reaching the Final Four**, but less than 5% chance of winning the championship

These findings provide a quantitative framework for understanding mid-tier seed performance in Women's March Madness and can inform both bracket predictions and broader understanding of tournament dynamics.

---

# 6. References

- Bradley, R.A. and Terry, M.E. (1952). "Rank analysis of incomplete block designs." *Biometrika*, 39, 324-345.
- Turner, H. & Firth, D. (2020). *BradleyTerry2: Bradley-Terry Models in R*. R package.
- Nesbitt, S. (2024). *wncaahoopR: Women's NCAA Basketball Data Package*. https://github.com/snestler/wncaahoopR

---

# Appendix: Technical Details

## Model Specification

The Bradley-Terry model was fit using maximum likelihood estimation via the `BradleyTerry2` R package. Regular season games only were included, with exhibition games and NCAA tournament games excluded.

## Computational Details

- **Software:** R 4.x.x
- **Key Packages:** `tidyverse`, `BradleyTerry2`, `wncaahoopR`
- **Simulation:** 5,000 Monte Carlo replications
- **Random Seed:** Set for reproducibility (seed = 479 + iteration)

## Code Availability

All analysis code is available in the project repository:
`/scripts/01_data_collection.R` through `/scripts/05_visualization.R`

---

*Report generated on `r Sys.Date()`*

